{"version":3,"sources":["webpack:///webpack/bootstrap b45d2dc15a8503f9e0c7","webpack:///./server/app.js","webpack:///external \"react\"","webpack:///external \"mobx-react\"","webpack:///external \"mobx\"","webpack:///./common/pages/Base.jsx","webpack:///external \"react-router\"","webpack:///./common/models/TodoModel.js","webpack:///./server/config/config.json","webpack:///external \"express\"","webpack:///external \"fs\"","webpack:///./common/App.jsx","webpack:///./common/pages/App/Vote.jsx","webpack:///./common/stores/TimerStore.js","webpack:///./common/stores/TodoStore.js","webpack:///./common/stores/spaStores.js","webpack:///./server/middlewares/renderReactMiddleware.jsx","webpack:///external \"ejs\"","webpack:///external \"events\"","webpack:///external \"react-dom/server\"","webpack:///external \"secure-filters\"","webpack:///./common/components/todo/Todo.jsx","webpack:///./common/components/todo/TodoList.jsx","webpack:///./common/fetchList/serverFetch.js","webpack:///./common/pages/App/About.jsx","webpack:///./common/pages/App/App.jsx","webpack:///./common/pages/timer/TimerPage.jsx","webpack:///./common/pages/todo/TodoPage.jsx","webpack:///./common/routes.js","webpack:///./common/stores/CommonStore.js","webpack:///./common/stores/VoteStore.js","webpack:///./common/utils/connectDataFetchers.jsx","webpack:///./server/apis/index.js","webpack:///./server/controllers/Timer.js","webpack:///./server/controllers/Todo.js","webpack:///./server/middlewares/allowCrossDomain.js","webpack:///./server/middlewares/spaRenderMatch.jsx","webpack:///./server/routes/index.js","webpack:///./server/utils/preRender.js","webpack:///external \"body-parser\"","webpack:///external \"compression\"","webpack:///external \"cookie-parser\"","webpack:///external \"csurf\"","webpack:///external \"express-session\"","webpack:///external \"helmet\"","webpack:///external \"http\"","webpack:///external \"morgan\""],"names":["app","set","IP","PORT","disable","use","contentSecurityPolicy","frameguard","noSniff","xssFilter","hsts","json","urlencoded","extended","resave","secret","key","saveUninitialized","cookie","httpOnly","static","__dirname","maxAge","req","res","next","locals","csrftoken","csrfToken","err","console","dir","status","error","stack","render","message","process","on","reason","p","warn","server","createServer","listen","get","address","port","log","serverName","eventMatchReg","getEventMethodsProps","instance","methods","Object","getOwnPropertyNames","filter","prop","test","instancePrototype","getPrototypeOf","prototype","concat","Base","constructor","props","context","__eventNames","__bindFunctions","funcBinded","bind","eventName","fn","Error","push","$eventBus","addListener","emit","args","off","events","index","indexOf","removeListener","splice","length","_reactInternalInstance","getName","name","componentWillUnmount","hasOwnProperty","contextTypes","instanceOf","TodoModel","data","setFinished","finished","fromJS","object","DevTools","require","default","mediator","App","state","devTools","getChildContext","$appConfig","appConfig","componentDidMount","setState","componentDidUpdate","children","defaultProps","propTypes","childContextTypes","Vote","VoteStore","pageConfig","pageId","TimerStore","startTimer","setInterval","timer","resetTimer","TodoStore","unfinishedTodoCount","todos","todo","addTodo","removeTodo","todoStore","map","item","configureStore","commonStore","common","timerStore","vote","stores","browser","window","__INITIAL_STATE__","getDefaultJSVersion","reactRender","defaultTemplate","readFileSync","webpackAssets","JSON","parse","ex","middlewareConfig","renderReactHTML","opts","template","component","store","needTransform","html","assign","debug","query","application","debugName","version","jsVersion","js","appName","finalLocals","title","css","pageStr","compileDebug","send","Todo","onChange","onRemoveTodo","e","TodoList","onAddTodo","preventDefault","todoList","id","getVote","Promise","resolve","reject","setTimeout","About","text","Children","only","TimerPage","onReset","TodoPage","ensure","requireModule","deps","callback","prevState","nextState","replace","cb","lastRoute","routes","location","pageComponent","OriginalPage","__APP_CONFIG__","CommonStore","loadData","then","resp","connectDataFetchers","IS_FIRST_MOUNT_AFTER_LOAD","FIRST_PAGE_ID","storeKeys","cache","Page","DataFetchersWrapper","fetchData","params","all","storeKey","shouldComponentUpdate","nextProps","prevProps","prevLocation","isUrlChanged","pathname","search","slice","_fetchDataOnClient","DATA_LOADED","shape","string","required","isRequired","router","post","module","exports","user","allowCrossDomain","allowedOrigins","origin","headers","header","renderMatch","history","time","Date","now","originalUrl","redirect","componentHTML","errorMsg","content","preRender","components","promises","current","WrappedComponent","lastComponent"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b45d2dc15a8503f9e0c7","import http from 'http';\r\nimport express from 'express';\r\nimport compress from 'compression';\r\nimport logger from 'morgan';\r\nimport cookieParser from 'cookie-parser';\r\nimport bodyParser from 'body-parser';\r\nimport session from 'express-session';\r\nimport csurf from 'csurf';\r\nimport config from './config/config.json';\r\nimport routes from './routes/index';\r\nimport apis from './apis/index';\r\nimport allowCrossDomain from './middlewares/allowCrossDomain'\r\nimport reactRender from './middlewares/renderReactMiddleware';\r\nimport helmet from 'helmet';\r\n// import socket from './sockets/socket';\r\nimport spaRenderMatch from './middlewares/spaRenderMatch.jsx';\r\n\r\nlet app = express();\r\n\r\napp.set('host', process.env.IP || '127.0.0.1');\r\napp.set('port', process.env.PORT || 3000);\r\napp.disable('x-powered-by');\r\n\r\napp.use(helmet.contentSecurityPolicy());\r\napp.use(helmet.frameguard());\r\napp.use(helmet.noSniff());\r\napp.use(helmet.xssFilter());\r\napp.use(helmet.hsts());\r\napp.use(compress());\r\napp.use(logger('dev'));\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(cookieParser());\r\napp.use(session({\r\n    resave: true,\r\n    secret: 'mySecretCookieSalt',\r\n    key: 'myCookieSessionId',\r\n    saveUninitialized: true,\r\n    cookie: {\r\n        httpOnly: true,\r\n    }\r\n}));\r\n\r\n// app.use(favicon(__dirname + '/../public/favicon.ico'));\r\napp.use('/static', express.static(__dirname + '/../public', {\r\n    maxAge: 86400000\r\n}));\r\n\r\n// if(process.env.NODE_ENV !== 'production'){\r\n//     let webpack = require('webpack');\r\n//     let config = require('../create-webpack.config')(true);\r\n//     let webpackDevMiddleware = require('webpack-dev-middleware');\r\n//     let webpackHotMiddleware = require('webpack-hot-middleware');\r\n//     let compiler = webpack(config);\r\n//     app.use(webpackDevMiddleware(compiler, { noInfo: true, publicPath: config.output.publicPath }));\r\n//     app.use(webpackHotMiddleware(compiler));\r\n// }\r\n\r\napp.use(allowCrossDomain);\r\n\r\napp.use(csurf());\r\napp.use(function (req, res, next) {\r\n    res.locals.csrftoken = req.csrfToken();\r\n    next();\r\n});\r\napp.use(reactRender());\r\n\r\napp.use('/api', apis);\r\napp.use('/', routes);\r\napp.use('*', spaRenderMatch);\r\n\r\n// error handlers\r\n// no stacktraces leaked to user\r\napp.use(function(err, req, res, next) {\r\n    console.dir(err);\r\n    res.status(err.status || 500);\r\n    if(err.status === 500) {\r\n        console.error(err.stack);\r\n        res.json({error: 'Internal Server Error'});\r\n    }\r\n    else if(err.status === 404) {\r\n        res.render('error');    //render error page\r\n    } else {\r\n        res.json({error: err.message})\r\n    }\r\n});\r\n\r\n\r\nprocess.on('uncaughtException', err => {\r\n    console.error(err.message + '\\n' + err.stack);\r\n});\r\nprocess.on('unhandledRejection', (reason, p) => {\r\n    console.error(\"Unhandled Rejection at: Promise \", p, \" reason: \", reason);\r\n});\r\nprocess.on('rejectionHandled', (reason, p) => {\r\n    console.warn(\"rejectionHandled at: Promise \", p, \" reason: \", reason);\r\n});\r\n\r\nlet server = http.createServer(app);\r\n\r\n/* Socket.io Communication */\r\n// let io = require('socket.io').listen(server);\r\n// io.sockets.on('connection', socket);\r\n\r\nserver.listen(app.get('port'), app.get('host'), function() {\r\n    let { address, port } = server.address();\r\n    console.log(`${ config.serverName } server listening at http://%s:%s`, address, port);\r\n});\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/app.js","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"mobx-react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mobx-react\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"mobx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mobx\"\n// module id = 3\n// module chunks = 0","import React, { PropTypes, Component } from 'react';\r\nimport EventEmitter from 'events';\r\n\r\nconst eventMatchReg = /^on[A-Z]/;\r\nfunction getEventMethodsProps(instance){\r\n    let methods = Object.getOwnPropertyNames(instance)\r\n        .filter((prop) => {\r\n            return eventMatchReg.test(prop)\r\n                && typeof instance[prop] === 'function';\r\n        });\r\n\r\n    let instancePrototype = Object.getPrototypeOf(instance);\r\n    if(instancePrototype !== Object.prototype) {\r\n        methods = methods.concat(getEventMethodsProps(instancePrototype));\r\n    }\r\n\r\n    return methods\r\n}\r\n\r\n\r\nexport default class Base extends Component {\r\n    constructor(props, context){\r\n        super(props, context);\r\n\r\n        this.__eventNames = {};\r\n\r\n        this.__bindFunctions();\r\n    }\r\n\r\n    __bindFunctions(){\r\n        let props = getEventMethodsProps(this);\r\n        for(let prop of props){\r\n            if(!this[prop].funcBinded){\r\n                this[prop] = this[prop].bind(this);\r\n                this[prop].funcBinded = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    on(eventName, fn){\r\n        if(typeof fn !== 'function') throw new Error('fn should be a function');\r\n\r\n        if(!this.__eventNames[eventName]){\r\n            this.__eventNames[eventName] = [fn];\r\n        } else {\r\n            this.__eventNames[eventName].push(fn);\r\n        }\r\n\r\n        return this.context.$eventBus.addListener(eventName, fn);\r\n    }\r\n\r\n    emit(eventName, ...args){\r\n        return this.context.$eventBus.emit(eventName, ...args);\r\n    }\r\n\r\n    off(eventName, fn){\r\n        let events = this.__eventNames[eventName];\r\n        if(events){\r\n            let index = events.indexOf(fn);\r\n\r\n            if(index >= 0) {\r\n                this.context.$eventBus.removeListener(eventName, fn);\r\n\r\n                events.splice(index, 1);\r\n\r\n                if(!events.length) {\r\n                    delete this.__eventNames[eventName];\r\n                }\r\n            } else {\r\n                console.warn('event: ' + eventName + ' is not registered in ' + this._reactInternalInstance.getName() + ' Component');\r\n            }\r\n\r\n            return true;\r\n        } else {\r\n            console.warn('event: ' + eventName + ' is not registered in ' + this.constructor.name + ' Component');\r\n\r\n            return false;\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(){\r\n        for(let eventName in this.__eventNames){\r\n            if(this.__eventNames.hasOwnProperty(eventName)){\r\n                for(let fn of this.__eventNames[eventName]){\r\n                    this.off(eventName, fn);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nBase.contextTypes = {\r\n    $eventBus: PropTypes.instanceOf(EventEmitter)\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/Base.jsx","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 5\n// module chunks = 0","import {\r\n    observable,\r\n    extendObservable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nclass TodoModel {\r\n    id;\r\n    @observable title = '';\r\n    @observable finished = false;\r\n\r\n\tconstructor(data) {\r\n        runInAction('initialize TodoModel', () => {\r\n            extendObservable(this, data);\r\n        });\r\n\t}\r\n\r\n    @action\r\n    setFinished(finished) {\r\n        this.finished = finished\r\n    }\r\n\r\n    static fromJS(object) {\r\n        return new TodoModel(object);\r\n    }\r\n}\r\n\r\nexport default TodoModel;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/models/TodoModel.js","module.exports = {\n\t\"application\": {\n\t\t\"version\": {\n\t\t\t\"css\": \"\",\n\t\t\t\"js\": \"\"\n\t\t},\n\t\t\"debugName\": \"test\"\n\t},\n\t\"serverName\": \"isomophic-react-redux-starter\"\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/config.json\n// module id = 7\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 9\n// module chunks = 0","import React, { Component, PropTypes } from 'react';\r\nimport EventEmitter from 'events';\r\nimport { useStrict } from 'mobx';\r\n\r\nuseStrict(true);\r\n\r\n\r\nif(process.env.NODE_ENV !== 'production' && process.browser){\r\n    var DevTools = require('mobx-react-devtools').default;\r\n}\r\n\r\nlet mediator = new EventEmitter();\r\n\r\nclass App extends Component {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            devTools: null\r\n        };\r\n    }\r\n\r\n    getChildContext(){\r\n        return {\r\n            $eventBus: mediator,\r\n            $appConfig: this.props.appConfig\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        if(DevTools) {\r\n            this.setState({\r\n                devTools: <DevTools/>\r\n            });\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(){\r\n    }\r\n\r\n    componentWillUnmount(){\r\n    }\r\n\r\n    render() {\r\n        // return React.Children.only(this.props.children);\r\n\r\n        return (\r\n            <div>\r\n                { this.props.children }\r\n                { this.state.devTools }\r\n            </div>\r\n        );\r\n    }\r\n}\r\nApp.defaultProps = {\r\n    appConfig: null\r\n};\r\nApp.propTypes = {\r\n    appConfig: PropTypes.object\r\n};\r\nApp.childContextTypes = {\r\n    $eventBus: PropTypes.instanceOf(EventEmitter),\r\n    $appConfig: PropTypes.object\r\n};\r\n\r\nexport default App;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/App.jsx","import React, { Component, PropTypes } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Link } from 'react-router';\r\n\r\nimport connectDataFetchers from '../../utils/connectDataFetchers';\r\n\r\n\r\n@observer(['commonStore', 'VoteStore'])\r\n@connectDataFetchers(['VoteStore'])\r\nclass Vote extends Component {\r\n    static pageConfig = {\r\n        pageId: 'Vote'\r\n    };\r\n    render() {\r\n        return (\r\n            <div className=\"vote\">\r\n                this is vote\r\n                <Link to=\"/about?debug=test\">about</Link>\r\n                <Link to=\"/test\">test</Link>\r\n                message: { this.props.VoteStore.message }\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Vote;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/App/Vote.jsx","import {\r\n    observable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nclass TimerStore {\r\n    @observable timer = 0;\r\n\r\n    constructor() {\r\n        \r\n    }\r\n\r\n    @action\r\n    startTimer(){\r\n        setInterval(action('startTimer', () => {\r\n            this.timer += 1;\r\n        }), 1000);\r\n    }\r\n\r\n    @action\r\n    resetTimer() {\r\n        this.timer = 0;\r\n    }\r\n}\r\n\r\nexport default TimerStore;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/TimerStore.js","import {\r\n    observable,\r\n    computed,\r\n    extendObservable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nimport TodoModel from '../models/TodoModel';\r\n\r\nclass TodoStore {\r\n    @observable todos = [];\r\n    @computed get unfinishedTodoCount() {\r\n        return this.todos.filter(todo => !todo.finished).length;\r\n    }\r\n\r\n    constructor(state = {}) {\r\n        // required in strict mode to be allowed to update state:\r\n        runInAction('initialize TodoStore', () => {\r\n            extendObservable(this, state);\r\n        });\r\n    }\r\n\r\n    @action\r\n    addTodo(todo) {\r\n        todo && this.todos.push(todo);\r\n    }\r\n\r\n    @action\r\n    removeTodo(index){\r\n        this.todos.splice(index, 1);\r\n    }\r\n\r\n    static fromJS(state) {\r\n        let todoStore = new TodoStore({\r\n            todos: state.todos.map(item => TodoModel.fromJS(item))\r\n        });\r\n        return todoStore;\r\n    }\r\n}\r\n\r\nexport default TodoStore;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/TodoStore.js","import CommonStore from './CommonStore';\r\nimport TimerStore from './TimerStore';\r\nimport TodoStore from './TodoStore';\r\nimport VoteStore from './VoteStore';\r\n\r\nexport default function configureStore(state = {}){\r\n    return {\r\n        commonStore: new CommonStore(state.common),\r\n        timerStore: new TimerStore(state.timer),\r\n        todoStore: new TodoStore(state.todo),\r\n        VoteStore: new VoteStore(state.vote)\r\n    };\r\n}\r\n\r\nexport let stores = process.browser ? configureStore(window.__INITIAL_STATE__) : {};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/spaStores.js","import ejs from 'ejs';\r\nimport React from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\nimport { Provider, useStaticRendering } from 'mobx-react'\r\nimport { jsObj as safeJSON } from 'secure-filters';\r\nimport fs from 'fs';\r\n\r\nimport App from '../../common/App.jsx';\r\nimport config from '../config/config.json';\r\n\r\nuseStaticRendering(true);\r\n\r\nconst defaultTemplate = fs.readFileSync(__dirname + '/../views/index.html', 'utf8');\r\n\r\nexport function getDefaultJSVersion(name) {\r\n    let webpackAssets = fs.readFileSync(__dirname + '/../../webpack-assets.json', 'utf8');\r\n\r\n    try {\r\n        webpackAssets = JSON.parse(webpackAssets);\r\n    } catch (ex) {\r\n        console.log('webpack-assets.json parsed error');\r\n        webpackAssets = {};\r\n    }\r\n    return webpackAssets[name];\r\n}\r\n\r\nexport default function reactRender(middlewareConfig = {}) {\r\n    return function (req, res, next) {\r\n        res.renderReactHTML = function (opts = {}) {\r\n            let {\r\n                template = '',\r\n                component = '',\r\n                store = {},\r\n                locals = {},\r\n                pageConfig = {},\r\n                needTransform = true\r\n            } = opts;\r\n            let html = '';\r\n            pageConfig = Object.assign(typeof middlewareConfig.appConfig === 'object'\r\n                ? middlewareConfig.appConfig : {}, pageConfig);\r\n\r\n            try {\r\n                html = renderToString((\r\n                    <Provider store={store}>\r\n                        <App appconfig={pageConfig}>\r\n                            {component}\r\n                        </App>\r\n                    </Provider>\r\n                ));\r\n            } catch (ex) {\r\n                html = 'internal server error: \\n' + ex.message;\r\n                console.error(ex.stack);\r\n            }\r\n\r\n            let debug = req.query.debug && (req.query.debug === config.application.debugName);\r\n            let version = config.application.version;\r\n            let jsVersion = '';\r\n            // prefer config version, useful when using CDN config\r\n            if (process.env.NODE_ENV === 'production') {\r\n                jsVersion = version && version.js;\r\n            } else {\r\n                jsVersion = getDefaultJSVersion(locals.appName || 'index');\r\n            }\r\n            template = template || middlewareConfig.defaultTemplate || defaultTemplate;\r\n\r\n            let finalLocals = Object.assign({\r\n                html,\r\n                state: safeJSON(store),\r\n                appName: 'index',\r\n                title: '',\r\n                test: process.env.NODE_ENV !== 'production',\r\n                debug,\r\n                appConfig: safeJSON(pageConfig),\r\n                version: {\r\n                    js: jsVersion,\r\n                    css: version && version.css\r\n                }\r\n            }, res.locals, locals);\r\n\r\n            let pageStr = ejs.render(template, finalLocals, {\r\n                compileDebug: false\r\n            });\r\n\r\n            res.status(200).send(pageStr);\r\n        };\r\n\r\n        next();\r\n    };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/renderReactMiddleware.jsx","module.exports = require(\"ejs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ejs\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"secure-filters\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"secure-filters\"\n// module id = 19\n// module chunks = 0","import React, {PropTypes, Component} from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport Base from '../../pages/Base';\r\n\r\n@observer\r\nclass Todo extends Base {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        // this.onChange = this.onChange.bind(this);\r\n        // this.removeTodo = this.removeTodo.bind(this);\r\n    }\r\n\r\n    onChange() {\r\n        let {todo} = this.props;\r\n\r\n        todo.setFinished(!todo.finished)\r\n    }\r\n\r\n    onRemoveTodo(e){\r\n        this.props.removeTodo(e, this.props.index);\r\n    }\r\n\r\n    render() {\r\n        let {todo, index} = this.props;\r\n\r\n        return (\r\n            <li>\r\n                <input\r\n                    type=\"checkbox\"\r\n                    checked={todo.finished}\r\n                    onChange={ this.onChange }\r\n                />{todo.title}\r\n                <button onClick={ this.props.addTodo }>add</button>\r\n                <button onClick={ this.onRemoveTodo }>remove</button>\r\n            </li>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Todo;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/components/todo/Todo.jsx","import React, { Component } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport Base from '../../pages/Base';\r\n\r\nimport Todo from './Todo';\r\nimport TodoModel from '../../models/TodoModel.js';\r\n\r\n@observer\r\nclass TodoList extends Base {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        // this.addTodo = this.addTodo.bind(this);\r\n        // this.removeTodo = this.removeTodo.bind(this);\r\n    }\r\n\r\n    onAddTodo(e) {\r\n        e.preventDefault();\r\n\r\n        let { todoList } = this.props;\r\n\r\n        todoList.addTodo(new TodoModel({\r\n            id: todoList.todos.length,\r\n            title: 'some text' + todoList.todos.length\r\n        }));\r\n    }\r\n\r\n    onRemoveTodo(e, index){\r\n        e.preventDefault();\r\n\r\n        let { todoList } = this.props;\r\n\r\n        todoList.removeTodo(index);\r\n    }\r\n\r\n    render() {\r\n        let { todoList } = this.props;\r\n\r\n        return (\r\n            <div>\r\n                <ul>\r\n                    {todoList.todos.map((todo, index) => {\r\n                        return (\r\n                            <Todo todo={todo}\r\n                        index={ index }\r\n                            key={todo.id} \r\n                            addTodo={this.onAddTodo}\r\n                            removeTodo={ this.onRemoveTodo }/>\r\n                        );\r\n                    })}\r\n                </ul>\r\n                Tasks left: {todoList.unfinishedTodoCount}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default TodoList;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/components/todo/TodoList.jsx","\r\nexport default {\r\n    getVote(opts, req){\r\n        return new Promise((resolve, reject) => {\r\n            setTimeout(() => {\r\n                resolve({\r\n                    data: {\r\n                        message: 123\r\n                    }\r\n                });\r\n            }, 500);\r\n        });\r\n    }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/fetchList/serverFetch.js","import React, { Component } from 'react';\r\nimport { Link } from 'react-router';\r\nimport { observer } from 'mobx-react';\r\n\r\n\r\n@observer(['commonStore'])\r\nclass About extends Component {\r\n    static pageConfig = {\r\n        pageId: 'About'\r\n    };\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"about\">\r\n                this is about page\r\n                <Link to=\"/vote?debug=test\">vote</Link>\r\n                text: {this.props.text}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default About;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/App/About.jsx","import React, { PropTypes } from 'react';\r\n\r\nlet App = ({children}) => {\r\n    return (\r\n        React.Children.only(children)\r\n    );\r\n};\r\n\r\nApp.propTypes = {\r\n    children: PropTypes.object\r\n};\r\n\r\nexport default App;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/App/App.jsx","import React, { Component } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport Base from '../Base';\r\n\r\n@observer(['store'])\r\nclass TimerPage extends Base {\r\n    constructor(props, context){\r\n        super(props, context);\r\n    }\r\n\r\n    componentDidMount(){\r\n        this.props.store.startTimer();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <button onClick={this.onReset}>\r\n                    Seconds passed: {this.props.store.timer}\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    onReset(){\r\n        this.props.store.resetTimer();\r\n    }\r\n}\r\n\r\nexport default TimerPage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/timer/TimerPage.jsx","import React, { Component } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport Base from '../Base';\r\n\r\nimport TodoList from '../../components/todo/TodoList';\r\n\r\n@observer(['store'])\r\nclass TodoPage extends Base {\r\n    constructor(props, context){\r\n        super(props, context);\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <TodoList todoList={ this.props.store }/>\r\n        );\r\n    }\r\n}\r\n\r\nexport default TodoPage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/todo/TodoPage.jsx","import React from 'react';\r\nimport { Route, IndexRoute } from 'react-router';\r\nimport App from './pages/App/App';\r\n// import Vote from './universalPage/Vote';\r\nimport About from './pages/App/About';\r\n\r\n// require.ensure polyfill for node\r\nif (typeof require.ensure !== 'function') {\r\n    require.ensure = function requireModule(deps, callback) {\r\n        callback(require);\r\n    };\r\n}\r\n\r\nfunction onChange(prevState, nextState, replace, cb){\r\n    let lastRoute = nextState.routes[nextState.routes.length - 1];\r\n\r\n    if(lastRoute.component) {\r\n        let component = lastRoute.component;\r\n        let location = nextState.location;\r\n        let pageComponent = component.OriginalPage ? component.OriginalPage : component;\r\n\r\n        Object.assign(window.__APP_CONFIG__, {\r\n            pageId: location.query.pageId || (pageComponent.pageConfig && pageComponent.pageConfig.pageId)\r\n        });\r\n    }\r\n\r\n    cb();\r\n}\r\n\r\n\r\nexport default (store) => {\r\n    return (\r\n        <Route path=\"/\" component={App} onChange={ onChange }>\r\n            <IndexRoute component={ require('./pages/App/Vote').default }/>\r\n            <Route path=\"vote\" component={ require('./pages/App/Vote').default }/>\r\n            <Route path=\"about\" component={About} />\r\n        </Route>\r\n    );\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/routes.js","import {\r\n    observable,\r\n    action,\r\n    runInAction,\r\n    extendObservable\r\n} from 'mobx';\r\n\r\nclass CommonStore {\r\n    constructor(state = {}) {\r\n        runInAction('CommonStore init', () => {\r\n            extendObservable(this, state)\r\n        });\r\n    }\r\n}\r\n\r\nexport default CommonStore;\n\n\n// WEBPACK FOOTER //\n// ./common/stores/CommonStore.js","import {\r\n    observable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nimport fetchList from '../fetchList';\r\n\r\nexport default class VoteStore {\r\n    @observable message = '';\r\n\r\n    constructor(){\r\n\r\n    }\r\n\r\n    @action\r\n    loadData(opts, req){\r\n        console.log('loadData...');\r\n\r\n        return fetchList.getVote(opts, req).then(action('update state after fetching data', (resp) => {\r\n            this.message = resp.data.message;\r\n        }));\r\n    }\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/VoteStore.js","import React, {\r\n    PropTypes\r\n} from 'react';\r\nimport { inject, observer } from 'mobx-react';\r\n\r\nimport Base from '../pages/Base';\r\nimport { stores } from '../stores/spaStores.js';\r\n\r\nlet IS_FIRST_MOUNT_AFTER_LOAD = true;\r\nif (process.browser) {\r\n    var FIRST_PAGE_ID = window.__APP_CONFIG__.pageId;\r\n}\r\n\r\n// todo\r\nexport default function connectDataFetchers(storeKeys = [], cache) {\r\n    return function (Page) {\r\n        if (process.browser) {\r\n            if (!Page.pageConfig) {\r\n                console.error(`Page Component static propery pageConfig.pageId required!`);\r\n            } else {\r\n                IS_FIRST_MOUNT_AFTER_LOAD = Page.pageConfig.pageId === FIRST_PAGE_ID;\r\n            }\r\n        }\r\n\r\n        @observer\r\n        class DataFetchersWrapper extends Base {\r\n            static propTypes = {\r\n                params: PropTypes.object,\r\n                location: PropTypes.shape({\r\n                    pathname: PropTypes.string.required,\r\n                    search: PropTypes.string,\r\n                    query: PropTypes.string.object\r\n                }).isRequired\r\n            };\r\n\r\n            static contextTypes = {\r\n                $appConfig: PropTypes.object\r\n            };\r\n\r\n            static OriginalPage = Page;\r\n\r\n            static fetchData({\r\n                location,\r\n                params,\r\n                appConfig,\r\n                pageConfig\r\n            }, req) {\r\n                console.log(stores);\r\n                return Promise.all(\r\n                    storeKeys.map(storeKey => {\r\n                        return stores[storeKey] && stores[storeKey].loadData({\r\n                            location,\r\n                            params,\r\n                            appConfig,\r\n                            pageConfig\r\n                        })\r\n                    }, req));\r\n            }\r\n\r\n            shouldComponentUpdate(nextProps) {\r\n                return this.props !== nextProps;\r\n            }\r\n\r\n            componentDidUpdate(prevProps) {\r\n                const {\r\n                    location\r\n                } = this.props;\r\n                const {\r\n                    location: prevLocation\r\n                } = prevProps;\r\n\r\n                const isUrlChanged = (location.pathname !== prevLocation.pathname) ||\r\n                    (location.search.slice(1) !== prevLocation.search.slice(1));\r\n\r\n                if (isUrlChanged) {\r\n                    this._fetchDataOnClient();\r\n                }\r\n            }\r\n\r\n            componentDidMount() {\r\n                if (!cache) {\r\n                    if (!IS_FIRST_MOUNT_AFTER_LOAD) {\r\n                        this._fetchDataOnClient();\r\n                    }\r\n\r\n                    IS_FIRST_MOUNT_AFTER_LOAD = false;\r\n                } else {\r\n                    if (!IS_FIRST_MOUNT_AFTER_LOAD && !Page.DATA_LOADED) {\r\n                        this._fetchDataOnClient();\r\n                    }\r\n\r\n                    Page.DATA_LOADED = true;\r\n                    IS_FIRST_MOUNT_AFTER_LOAD = false;\r\n                }\r\n            }\r\n\r\n            _fetchDataOnClient() {\r\n                this.constructor.fetchData({\r\n                    params: this.props.params,\r\n                    location: this.props.location,\r\n                    appConfig: this.context.$appConfig\r\n                });\r\n            }\r\n\r\n            render() {\r\n                return ( \r\n                    <Page {...this.props }/>\r\n                );\r\n            }\r\n        }\r\n\r\n        return DataFetchersWrapper;\r\n    };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/utils/connectDataFetchers.jsx","import { Router } from 'express';\r\n\r\nlet router = new Router();\r\n\r\nrouter.post('/ajax', function(req, res, next){\r\n    if(error) {\r\n        next();\r\n    } else {\r\n        res.send('test')\r\n    }\r\n});\r\n\r\nexport default router;\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/apis/index.js","import React from 'react';\r\nimport Page from '../../common/pages/timer/TimerPage.jsx';\r\nimport Store from '../../common/stores/TimerStore';\r\n\r\n\r\nmodule.exports = function (req, res, next) {\r\n    res.renderReactHTML({\r\n        component: <Page/>,\r\n        store: new Store(),\r\n        locals: {\r\n            appName: 'timer',\r\n            title: 'timer page'\r\n        },\r\n        pageConfig: {\r\n            user: 'test'\r\n        }\r\n    });\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/Timer.js","import React from 'react';\r\nimport Page from '../../common/pages/todo/TodoPage.jsx';\r\nimport Store from '../../common/stores/TodoStore';\r\nimport TodoModel from '../../common/models/TodoModel';\r\n\r\n\r\nmodule.exports = function (req, res, next) {\r\n    let store = new Store();\r\n\r\n    store.addTodo(new TodoModel({\r\n        id: 0,\r\n        title: \"Get Coffee\"\r\n    }));\r\n    store.addTodo(new TodoModel({\r\n        id: 1,\r\n        title: \"Write simpler code\"\r\n    }));\r\n\r\n    store.todos[0].setFinished(true);\r\n\r\n    res.renderReactHTML({\r\n        component: <Page/> ,\r\n        store,\r\n        locals: {\r\n            appName: 'todo',\r\n            title: 'todo page'\r\n        },\r\n        pageConfig: {\r\n            user: 'test'\r\n        }\r\n    });\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/Todo.js","\r\nexport default function allowCrossDomain(req, res, next) {\r\n    let allowedOrigins = [\r\n        'http://www.test.com'\r\n    ];\r\n    let origin = req.headers.origin;\r\n    if(allowedOrigins.indexOf(origin) > -1){\r\n        res.header('Access-Control-Allow-Origin', origin);\r\n    }\r\n    next();\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/allowCrossDomain.js","import React from 'react';\r\nimport {renderToString} from 'react-dom/server';\r\nimport {createMemoryHistory, match, RouterContext} from 'react-router';\r\nimport { Provider, useStaticRendering } from 'mobx-react';\r\nimport createRoutes from '../../common/routes';\r\nimport configureStore from '../../common/stores/spaStores.js';\r\nimport preRenderMiddleware from '../utils/preRender';\r\nimport ejs from 'ejs';\r\nimport config from '../config/config.json';\r\nimport { getDefaultJSVersion } from './renderReactMiddleware';\r\nimport App from '../../common/App.jsx';\r\nimport { jsObj as safeJSON } from 'secure-filters';\r\nimport fs from 'fs';\r\n\r\nconst defaultTemplate = fs.readFileSync(__dirname + '/../views/index.html', 'utf8');\r\n\r\n\r\nexport default function renderMatch(req, res) {\r\n    const history = createMemoryHistory();\r\n    const stores = configureStore({\r\n        common: {\r\n            user: {}\r\n        }\r\n    });\r\n    let appConfig = {\r\n        time: Date.now()\r\n    };\r\n    const routes = createRoutes(stores, appConfig);\r\n\r\n    match({routes, location: req.originalUrl}, async function (err, redirect, props){\r\n        if (err) {\r\n            res.status(500).json(err);\r\n        } else if (redirect) {\r\n            res.redirect(302, redirect.pathname + redirect.search);\r\n        } else if (props) {\r\n            let debug = req.query.debug && (req.query.debug === config.application.debugName);\r\n            let version = config.application.version;\r\n            let jsVersion = '';\r\n            // prefer config version, useful when using CDN config\r\n            if (process.env.NODE_ENV === 'production') {\r\n                jsVersion = version && version.js;\r\n            } else {\r\n                jsVersion = getDefaultJSVersion('app');\r\n            }\r\n            let componentHTML = '';\r\n            let errorMsg = '';\r\n\r\n            try {\r\n                await preRenderMiddleware(stores, props, appConfig, req);\r\n\r\n                componentHTML = renderToString(\r\n                    <Provider { ...stores }>\r\n                        <App appConfig={ appConfig }>\r\n                            <RouterContext {...props} />\r\n                        </App>\r\n                    </Provider>\r\n                );\r\n\r\n            } catch(ex){\r\n                errorMsg = ex.stack;\r\n                console.log(ex.stack)\r\n            }\r\n\r\n            let pageStr = ejs.render(defaultTemplate, Object.assign({\r\n                errorMsg,\r\n                html: componentHTML,\r\n                state: safeJSON(stores),\r\n                appName: 'app',\r\n                title: '',\r\n                test: process.env.NODE_ENV !== 'production',\r\n                debug: debug,\r\n                appConfig: safeJSON(appConfig),\r\n                version: {\r\n                    js: jsVersion,\r\n                    css: version && version.css\r\n                }\r\n            }, {}), {\r\n                compileDebug: false\r\n            });\r\n\r\n            res.status(200).send(pageStr);\r\n\r\n        } else {\r\n            res.redirect('/');\r\n        }\r\n    });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/spaRenderMatch.jsx","import { Router } from 'express';\r\nimport fs from 'fs';\r\n\r\nlet router = new Router();\r\n\r\nimport Timer from '../controllers/Timer';\r\nimport Todo from '../controllers/Todo';\r\n\r\n\r\n/**\r\n * \r\n */\r\nrouter.get('/', Timer);\r\nrouter.get('/todo', Todo);\r\n\r\n\r\n/**\r\n * \r\n */\r\nlet content = fs.readFileSync(__dirname + '/../../client/js/utils/sw.js', 'utf8');\r\n\r\nrouter.get('/sw.js', async function(req, res){\r\n    res.set('Content-Type', 'application/javascript');\r\n    res.send(content);\r\n});\r\n\r\nexport default router;\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/index.js","function preRender(stores, { components, location, params }, appConfig = {}, req) {\r\n    const promises = components.map((current) => {\r\n        if(!current) return null;\r\n\r\n        const component = current.WrappedComponent ? current.WrappedComponent : current;\r\n        const pageConfig = component.OriginalPage && component.OriginalPage.pageConfig;\r\n\r\n        return component.fetchData ? component.fetchData({ stores, location, params, appConfig, pageConfig }, req) : null;\r\n    });\r\n\r\n    let lastComponent = components[components.length - 1].WrappedComponent ? components[components.length - 1].WrappedComponent : components[components.length - 1];\r\n    appConfig.pageId = lastComponent && lastComponent.OriginalPage && lastComponent.OriginalPage.pageConfig && lastComponent.OriginalPage.pageConfig.pageId;\r\n\r\n    return Promise.all(promises);\r\n}\r\n\r\nexport default preRender;\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/utils/preRender.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 39\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 40\n// module chunks = 0","module.exports = require(\"csurf\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"csurf\"\n// module id = 41\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 42\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 43\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 44\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 45\n// module chunks = 0"],"sourceRoot":""}