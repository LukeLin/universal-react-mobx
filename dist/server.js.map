{"version":3,"sources":["webpack:///webpack/bootstrap 5e64aa92b9ea5241814f","webpack:///./server/app.js","webpack:///external \"react\"","webpack:///external \"mobx-react\"","webpack:///external \"mobx\"","webpack:///./common/pages/Base.jsx","webpack:///external \"react-router\"","webpack:///./common/models/TodoModel.js","webpack:///./server/config/config.json","webpack:///external \"express\"","webpack:///external \"fs\"","webpack:///./common/App.jsx","webpack:///./common/pages/App/Vote.jsx","webpack:///./common/stores/TimerStore.js","webpack:///./common/stores/TodoStore.js","webpack:///./server/middlewares/renderReactMiddleware.jsx","webpack:///external \"ejs\"","webpack:///external \"events\"","webpack:///external \"react-dom/server\"","webpack:///external \"secure-filters\"","webpack:///./common/components/todo/Todo.jsx","webpack:///./common/components/todo/TodoList.jsx","webpack:///./common/fetchList/serverFetch.js","webpack:///./common/pages/App/About.jsx","webpack:///./common/pages/App/App.jsx","webpack:///./common/pages/timer/TimerPage.jsx","webpack:///./common/pages/todo/TodoPage.jsx","webpack:///./common/routes.js","webpack:///./common/stores/CommonStore.js","webpack:///./common/stores/VoteStore.js","webpack:///./common/stores/spaStores.js","webpack:///./common/utils/connectDataFetchers.jsx","webpack:///./server/apis/index.js","webpack:///./server/controllers/Timer.js","webpack:///./server/controllers/Todo.js","webpack:///./server/middlewares/allowCrossDomain.js","webpack:///./server/middlewares/spaRenderMatch.jsx","webpack:///./server/routes/index.js","webpack:///./server/utils/preRender.js","webpack:///external \"body-parser\"","webpack:///external \"compression\"","webpack:///external \"cookie-parser\"","webpack:///external \"csurf\"","webpack:///external \"express-session\"","webpack:///external \"helmet\"","webpack:///external \"http\"","webpack:///external \"morgan\""],"names":["app","set","IP","PORT","disable","use","contentSecurityPolicy","frameguard","noSniff","xssFilter","hsts","json","urlencoded","extended","resave","secret","key","saveUninitialized","cookie","httpOnly","static","__dirname","maxAge","req","res","next","locals","csrftoken","csrfToken","err","console","dir","status","error","stack","render","message","process","on","reason","p","warn","server","createServer","listen","get","address","port","log","serverName","eventMatchReg","getEventMethodsProps","instance","methods","Object","getOwnPropertyNames","filter","prop","test","instancePrototype","getPrototypeOf","prototype","concat","Base","constructor","props","context","__eventNames","__bindFunctions","funcBinded","bind","eventName","fn","Error","push","$eventBus","addListener","emit","args","off","events","index","indexOf","removeListener","splice","length","_reactInternalInstance","getName","name","componentWillUnmount","hasOwnProperty","contextTypes","instanceOf","TodoModel","data","setFinished","finished","fromJS","object","DevTools","require","default","mediator","App","state","devTools","getChildContext","$appConfig","appConfig","componentDidMount","setState","left","bottom","componentDidUpdate","children","Children","only","defaultProps","propTypes","childContextTypes","Vote","VoteStore","pageConfig","pageId","TimerStore","startTimer","setInterval","timer","resetTimer","TodoStore","unfinishedTodoCount","todos","todo","addTodo","removeTodo","todoStore","map","item","getDefaultJSVersion","reactRender","defaultTemplate","readFileSync","webpackAssets","JSON","parse","ex","middlewareConfig","renderReactHTML","opts","template","component","store","needTransform","html","assign","debug","query","application","debugName","version","jsVersion","js","appName","finalLocals","title","css","pageStr","compileDebug","send","Todo","onChange","onRemoveTodo","e","TodoList","onAddTodo","preventDefault","todoList","id","getVote","Promise","resolve","reject","setTimeout","About","commonStore","user","TimerPage","onReset","TodoPage","stores","ensure","requireModule","deps","callback","prevState","nextState","replace","cb","lastRoute","routes","location","pageComponent","OriginalPage","window","__APP_CONFIG__","CommonStore","loadData","then","resp","configureStore","initStore","Store","timerStore","connectDataFetchers","IS_FIRST_MOUNT_AFTER_LOAD","browser","FIRST_PAGE_ID","storeKeys","cache","Page","DataFetchersWrapper","fetchData","params","all","storeKey","currentStore","shouldComponentUpdate","nextProps","prevProps","prevLocation","isUrlChanged","pathname","search","slice","_fetchDataOnClient","DATA_LOADED","mobxStores","shape","string","required","isRequired","router","post","module","exports","allowCrossDomain","allowedOrigins","origin","headers","header","renderMatch","history","time","Date","now","originalUrl","redirect","componentHTML","errorMsg","content","preRender","components","promises","current","WrappedComponent","lastComponent"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5e64aa92b9ea5241814f","import http from 'http';\r\nimport express from 'express';\r\nimport compress from 'compression';\r\nimport logger from 'morgan';\r\nimport cookieParser from 'cookie-parser';\r\nimport bodyParser from 'body-parser';\r\nimport session from 'express-session';\r\nimport csurf from 'csurf';\r\nimport config from './config/config.json';\r\nimport routes from './routes/index';\r\nimport apis from './apis/index';\r\nimport allowCrossDomain from './middlewares/allowCrossDomain'\r\nimport reactRender from './middlewares/renderReactMiddleware';\r\nimport helmet from 'helmet';\r\n// import socket from './sockets/socket';\r\nimport spaRenderMatch from './middlewares/spaRenderMatch.jsx';\r\n\r\nlet app = express();\r\n\r\napp.set('host', process.env.IP || '127.0.0.1');\r\napp.set('port', process.env.PORT || 3000);\r\napp.disable('x-powered-by');\r\n\r\napp.use(helmet.contentSecurityPolicy());\r\napp.use(helmet.frameguard());\r\napp.use(helmet.noSniff());\r\napp.use(helmet.xssFilter());\r\napp.use(helmet.hsts());\r\napp.use(compress());\r\napp.use(logger('dev'));\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(cookieParser());\r\napp.use(session({\r\n    resave: true,\r\n    secret: 'mySecretCookieSalt',\r\n    key: 'myCookieSessionId',\r\n    saveUninitialized: true,\r\n    cookie: {\r\n        httpOnly: true,\r\n    }\r\n}));\r\n\r\n// app.use(favicon(__dirname + '/../public/favicon.ico'));\r\napp.use('/static', express.static(__dirname + '/../public', {\r\n    maxAge: 86400000\r\n}));\r\n\r\n// if(process.env.NODE_ENV !== 'production'){\r\n//     let webpack = require('webpack');\r\n//     let config = require('../create-webpack.config')(true);\r\n//     let webpackDevMiddleware = require('webpack-dev-middleware');\r\n//     let webpackHotMiddleware = require('webpack-hot-middleware');\r\n//     let compiler = webpack(config);\r\n//     app.use(webpackDevMiddleware(compiler, { noInfo: true, publicPath: config.output.publicPath }));\r\n//     app.use(webpackHotMiddleware(compiler));\r\n// }\r\n\r\napp.use(allowCrossDomain);\r\n\r\napp.use(csurf());\r\napp.use(function (req, res, next) {\r\n    res.locals.csrftoken = req.csrfToken();\r\n    next();\r\n});\r\napp.use(reactRender());\r\n\r\napp.use('/api', apis);\r\napp.use('/', routes);\r\napp.use('*', spaRenderMatch);\r\n\r\n// error handlers\r\n// no stacktraces leaked to user\r\napp.use(function(err, req, res, next) {\r\n    console.dir(err);\r\n    res.status(err.status || 500);\r\n    if(err.status === 500) {\r\n        console.error(err.stack);\r\n        res.json({error: 'Internal Server Error'});\r\n    }\r\n    else if(err.status === 404) {\r\n        res.render('error');    //render error page\r\n    } else {\r\n        res.json({error: err.message})\r\n    }\r\n});\r\n\r\n\r\nprocess.on('uncaughtException', err => {\r\n    console.error(err.message + '\\n' + err.stack);\r\n});\r\nprocess.on('unhandledRejection', (reason, p) => {\r\n    console.error(\"Unhandled Rejection at: Promise \", p, \" reason: \", reason);\r\n});\r\nprocess.on('rejectionHandled', (reason, p) => {\r\n    console.warn(\"rejectionHandled at: Promise \", p, \" reason: \", reason);\r\n});\r\n\r\nlet server = http.createServer(app);\r\n\r\n/* Socket.io Communication */\r\n// let io = require('socket.io').listen(server);\r\n// io.sockets.on('connection', socket);\r\n\r\nserver.listen(app.get('port'), app.get('host'), function() {\r\n    let { address, port } = server.address();\r\n    console.log(`${ config.serverName } server listening at http://%s:%s`, address, port);\r\n});\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/app.js","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"mobx-react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mobx-react\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"mobx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mobx\"\n// module id = 3\n// module chunks = 0","import React, { PropTypes, Component } from 'react';\r\nimport EventEmitter from 'events';\r\n\r\nconst eventMatchReg = /^on[A-Z]/;\r\nfunction getEventMethodsProps(instance){\r\n    let methods = Object.getOwnPropertyNames(instance)\r\n        .filter((prop) => {\r\n            return eventMatchReg.test(prop)\r\n                && typeof instance[prop] === 'function';\r\n        });\r\n\r\n    let instancePrototype = Object.getPrototypeOf(instance);\r\n    if(instancePrototype !== Object.prototype) {\r\n        methods = methods.concat(getEventMethodsProps(instancePrototype));\r\n    }\r\n\r\n    return methods\r\n}\r\n\r\n\r\nexport default class Base extends Component {\r\n    constructor(props, context){\r\n        super(props, context);\r\n\r\n        this.__eventNames = {};\r\n\r\n        this.__bindFunctions();\r\n    }\r\n\r\n    __bindFunctions(){\r\n        let props = getEventMethodsProps(this);\r\n        for(let prop of props){\r\n            if(!this[prop].funcBinded){\r\n                this[prop] = this[prop].bind(this);\r\n                this[prop].funcBinded = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    on(eventName, fn){\r\n        if(typeof fn !== 'function') throw new Error('fn should be a function');\r\n\r\n        if(!this.__eventNames[eventName]){\r\n            this.__eventNames[eventName] = [fn];\r\n        } else {\r\n            this.__eventNames[eventName].push(fn);\r\n        }\r\n\r\n        return this.context.$eventBus.addListener(eventName, fn);\r\n    }\r\n\r\n    emit(eventName, ...args){\r\n        return this.context.$eventBus.emit(eventName, ...args);\r\n    }\r\n\r\n    off(eventName, fn){\r\n        let events = this.__eventNames[eventName];\r\n        if(events){\r\n            let index = events.indexOf(fn);\r\n\r\n            if(index >= 0) {\r\n                this.context.$eventBus.removeListener(eventName, fn);\r\n\r\n                events.splice(index, 1);\r\n\r\n                if(!events.length) {\r\n                    delete this.__eventNames[eventName];\r\n                }\r\n            } else {\r\n                console.warn('event: ' + eventName + ' is not registered in ' + this._reactInternalInstance.getName() + ' Component');\r\n            }\r\n\r\n            return true;\r\n        } else {\r\n            console.warn('event: ' + eventName + ' is not registered in ' + this.constructor.name + ' Component');\r\n\r\n            return false;\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(){\r\n        for(let eventName in this.__eventNames){\r\n            if(this.__eventNames.hasOwnProperty(eventName)){\r\n                for(let fn of this.__eventNames[eventName]){\r\n                    this.off(eventName, fn);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nBase.contextTypes = {\r\n    $eventBus: PropTypes.instanceOf(EventEmitter)\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/Base.jsx","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 5\n// module chunks = 0","import {\r\n    observable,\r\n    extendObservable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nclass TodoModel {\r\n    id;\r\n    @observable title = '';\r\n    @observable finished = false;\r\n\r\n\tconstructor(data) {\r\n        runInAction('initialize TodoModel', () => {\r\n            extendObservable(this, data);\r\n        });\r\n\t}\r\n\r\n    @action\r\n    setFinished(finished) {\r\n        this.finished = finished\r\n    }\r\n\r\n    static fromJS(object) {\r\n        return new TodoModel(object);\r\n    }\r\n}\r\n\r\nexport default TodoModel;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/models/TodoModel.js","module.exports = {\n\t\"application\": {\n\t\t\"version\": {\n\t\t\t\"css\": \"\",\n\t\t\t\"js\": \"\"\n\t\t},\n\t\t\"debugName\": \"test\"\n\t},\n\t\"serverName\": \"isomophic-react-redux-starter\"\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/config.json\n// module id = 7\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 9\n// module chunks = 0","import React, { Component, PropTypes } from 'react';\r\nimport EventEmitter from 'events';\r\nimport { useStrict } from 'mobx';\r\n\r\nuseStrict(true);\r\n\r\n\r\nif(process.env.NODE_ENV !== 'production' && process.browser){\r\n    var DevTools = require('mobx-react-devtools').default;\r\n}\r\n\r\nlet mediator = new EventEmitter();\r\n\r\nclass App extends Component {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        this.state = {\r\n            devTools: null\r\n        };\r\n    }\r\n\r\n    getChildContext(){\r\n        return {\r\n            $eventBus: mediator,\r\n            $appConfig: this.props.appConfig\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        if(DevTools) {\r\n            this.setState({\r\n                devTools: <DevTools position={ { left: 0, bottom: 0 } }/>\r\n            });\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(){\r\n    }\r\n\r\n    componentWillUnmount(){\r\n    }\r\n\r\n    render() {\r\n        if(this.state.devTools) {\r\n            return (\r\n                <div>\r\n                    { this.props.children }\r\n                    { this.state.devTools }\r\n                </div>\r\n            );\r\n        } else {\r\n            return React.Children.only(this.props.children);\r\n        }\r\n    }\r\n}\r\nApp.defaultProps = {\r\n    appConfig: null\r\n};\r\nApp.propTypes = {\r\n    appConfig: PropTypes.object\r\n};\r\nApp.childContextTypes = {\r\n    $eventBus: PropTypes.instanceOf(EventEmitter),\r\n    $appConfig: PropTypes.object\r\n};\r\n\r\nexport default App;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/App.jsx","import React, { Component, PropTypes } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Link } from 'react-router';\r\n\r\nimport connectDataFetchers from '../../utils/connectDataFetchers';\r\n\r\n\r\n@connectDataFetchers(['VoteStore'])\r\n@observer(['VoteStore'])\r\nclass Vote extends Component {\r\n    static pageConfig = {\r\n        pageId: 'Vote'\r\n    };\r\n    render() {\r\n        return (\r\n            <div className=\"vote\">\r\n                this is vote\r\n                <Link to=\"/about?debug=test\">about</Link>\r\n                <Link to=\"/test\">test</Link>\r\n                message: { this.props.VoteStore.message }\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Vote;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/App/Vote.jsx","import {\r\n    observable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nclass TimerStore {\r\n    @observable timer = 0;\r\n\r\n    constructor() {\r\n        \r\n    }\r\n\r\n    @action\r\n    startTimer(){\r\n        setInterval(action('startTimer', () => {\r\n            this.timer += 1;\r\n        }), 1000);\r\n    }\r\n\r\n    @action\r\n    resetTimer() {\r\n        this.timer = 0;\r\n    }\r\n}\r\n\r\nexport default TimerStore;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/TimerStore.js","import {\r\n    observable,\r\n    computed,\r\n    extendObservable,\r\n    action,\r\n    runInAction\r\n} from 'mobx';\r\n\r\nimport TodoModel from '../models/TodoModel';\r\n\r\nclass TodoStore {\r\n    @observable todos = [];\r\n    @computed get unfinishedTodoCount() {\r\n        return this.todos.filter(todo => !todo.finished).length;\r\n    }\r\n\r\n    constructor(state = {}) {\r\n        // required in strict mode to be allowed to update state:\r\n        runInAction('initialize TodoStore', () => {\r\n            extendObservable(this, state);\r\n        });\r\n    }\r\n\r\n    @action\r\n    addTodo(todo) {\r\n        todo && this.todos.push(todo);\r\n    }\r\n\r\n    @action\r\n    removeTodo(index){\r\n        this.todos.splice(index, 1);\r\n    }\r\n\r\n    static fromJS(state) {\r\n        if(state && state.todos) {\r\n            let todoStore = new TodoStore({\r\n                todos: state.todos.map(item => TodoModel.fromJS(item))\r\n            });\r\n            return todoStore;\r\n        }\r\n    }\r\n}\r\n\r\nexport default TodoStore;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/TodoStore.js","import ejs from 'ejs';\r\nimport React from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\nimport { Provider, useStaticRendering } from 'mobx-react'\r\nimport { jsObj as safeJSON } from 'secure-filters';\r\nimport fs from 'fs';\r\n\r\nimport App from '../../common/App.jsx';\r\nimport config from '../config/config.json';\r\n\r\nuseStaticRendering(true);\r\n\r\nconst defaultTemplate = fs.readFileSync(__dirname + '/../views/index.html', 'utf8');\r\n\r\nexport function getDefaultJSVersion(name) {\r\n    let webpackAssets = fs.readFileSync(__dirname + '/../../webpack-assets.json', 'utf8');\r\n\r\n    try {\r\n        webpackAssets = JSON.parse(webpackAssets);\r\n    } catch (ex) {\r\n        console.log('webpack-assets.json parsed error');\r\n        webpackAssets = {};\r\n    }\r\n    return webpackAssets[name];\r\n}\r\n\r\nexport default function reactRender(middlewareConfig = {}) {\r\n    return function (req, res, next) {\r\n        res.renderReactHTML = function (opts = {}) {\r\n            let {\r\n                template = '',\r\n                component = '',\r\n                store = {},\r\n                locals = {},\r\n                pageConfig = {},\r\n                needTransform = true\r\n            } = opts;\r\n            let html = '';\r\n            pageConfig = Object.assign(typeof middlewareConfig.appConfig === 'object'\r\n                ? middlewareConfig.appConfig : {}, pageConfig);\r\n\r\n            try {\r\n                html = renderToString((\r\n                    <Provider store={store}>\r\n                        <App appconfig={pageConfig}>\r\n                            {component}\r\n                        </App>\r\n                    </Provider>\r\n                ));\r\n            } catch (ex) {\r\n                html = 'internal server error: \\n' + ex.message;\r\n                console.error(ex.stack);\r\n            }\r\n\r\n            let debug = req.query.debug && (req.query.debug === config.application.debugName);\r\n            let version = config.application.version;\r\n            let jsVersion = '';\r\n            // prefer config version, useful when using CDN config\r\n            if (process.env.NODE_ENV === 'production') {\r\n                jsVersion = version && version.js;\r\n            } else {\r\n                jsVersion = getDefaultJSVersion(locals.appName || 'index');\r\n            }\r\n            template = template || middlewareConfig.defaultTemplate || defaultTemplate;\r\n\r\n            let finalLocals = Object.assign({\r\n                html,\r\n                state: safeJSON(store),\r\n                appName: 'index',\r\n                title: '',\r\n                test: process.env.NODE_ENV !== 'production',\r\n                debug,\r\n                appConfig: safeJSON(pageConfig),\r\n                version: {\r\n                    js: jsVersion,\r\n                    css: version && version.css\r\n                }\r\n            }, res.locals, locals);\r\n\r\n            let pageStr = ejs.render(template, finalLocals, {\r\n                compileDebug: false\r\n            });\r\n\r\n            res.status(200).send(pageStr);\r\n        };\r\n\r\n        next();\r\n    };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/renderReactMiddleware.jsx","module.exports = require(\"ejs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ejs\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"secure-filters\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"secure-filters\"\n// module id = 18\n// module chunks = 0","import React, {PropTypes, Component} from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport Base from '../../pages/Base';\r\n\r\n@observer\r\nclass Todo extends Base {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        // this.onChange = this.onChange.bind(this);\r\n        // this.removeTodo = this.removeTodo.bind(this);\r\n    }\r\n\r\n    onChange() {\r\n        let {todo} = this.props;\r\n\r\n        todo.setFinished(!todo.finished)\r\n    }\r\n\r\n    onRemoveTodo(e){\r\n        this.props.removeTodo(e, this.props.index);\r\n    }\r\n\r\n    render() {\r\n        let {todo, index} = this.props;\r\n\r\n        return (\r\n            <li>\r\n                <input\r\n                    type=\"checkbox\"\r\n                    checked={todo.finished}\r\n                    onChange={ this.onChange }\r\n                />{todo.title}\r\n                <button onClick={ this.props.addTodo }>add</button>\r\n                <button onClick={ this.onRemoveTodo }>remove</button>\r\n            </li>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Todo;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/components/todo/Todo.jsx","import React, { Component } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport Base from '../../pages/Base';\r\n\r\nimport Todo from './Todo';\r\nimport TodoModel from '../../models/TodoModel.js';\r\n\r\n@observer\r\nclass TodoList extends Base {\r\n    constructor(props, context) {\r\n        super(props, context);\r\n\r\n        // this.addTodo = this.addTodo.bind(this);\r\n        // this.removeTodo = this.removeTodo.bind(this);\r\n    }\r\n\r\n    onAddTodo(e) {\r\n        e.preventDefault();\r\n\r\n        let { todoList } = this.props;\r\n\r\n        todoList.addTodo(new TodoModel({\r\n            id: todoList.todos.length,\r\n            title: 'some text' + todoList.todos.length\r\n        }));\r\n    }\r\n\r\n    onRemoveTodo(e, index){\r\n        e.preventDefault();\r\n\r\n        let { todoList } = this.props;\r\n\r\n        todoList.removeTodo(index);\r\n    }\r\n\r\n    render() {\r\n        let { todoList } = this.props;\r\n\r\n        return (\r\n            <div>\r\n                <ul>\r\n                    {todoList.todos.map((todo, index) => {\r\n                        return (\r\n                            <Todo todo={todo}\r\n                        index={ index }\r\n                            key={todo.id} \r\n                            addTodo={this.onAddTodo}\r\n                            removeTodo={ this.onRemoveTodo }/>\r\n                        );\r\n                    })}\r\n                </ul>\r\n                Tasks left: {todoList.unfinishedTodoCount}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default TodoList;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/components/todo/TodoList.jsx","\r\nexport default {\r\n    getVote(opts, req){\r\n        return new Promise((resolve, reject) => {\r\n            setTimeout(() => {\r\n                resolve({\r\n                    data: {\r\n                        message: 123\r\n                    }\r\n                });\r\n            }, 500);\r\n        });\r\n    }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/fetchList/serverFetch.js","import React, { Component } from 'react';\r\nimport { Link } from 'react-router';\r\nimport { observer } from 'mobx-react';\r\n\r\n\r\n@observer(['commonStore'])\r\nclass About extends Component {\r\n    static pageConfig = {\r\n        pageId: 'About'\r\n    };\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"about\">\r\n                this is about page\r\n                <Link to=\"/vote?debug=test\">vote</Link>\r\n                <br/>\r\n                userName: {this.props.commonStore.user.name}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default About;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/App/About.jsx","import React, { PropTypes } from 'react';\r\n\r\nlet App = ({children}) => {\r\n    return (\r\n        React.Children.only(children)\r\n    );\r\n};\r\n\r\nApp.propTypes = {\r\n    children: PropTypes.object\r\n};\r\n\r\nexport default App;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/App/App.jsx","import React, { Component } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport Base from '../Base';\r\n\r\n@observer(['store'])\r\nclass TimerPage extends Base {\r\n    constructor(props, context){\r\n        super(props, context);\r\n    }\r\n\r\n    componentDidMount(){\r\n        this.props.store.startTimer();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <button onClick={this.onReset}>\r\n                    Seconds passed: {this.props.store.timer}\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    onReset(){\r\n        this.props.store.resetTimer();\r\n    }\r\n}\r\n\r\nexport default TimerPage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/timer/TimerPage.jsx","import React, { Component } from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport Base from '../Base';\r\n\r\nimport TodoList from '../../components/todo/TodoList';\r\n\r\n@observer(['store'])\r\nclass TodoPage extends Base {\r\n    constructor(props, context){\r\n        super(props, context);\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <TodoList todoList={ this.props.store }/>\r\n        );\r\n    }\r\n}\r\n\r\nexport default TodoPage;\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/pages/todo/TodoPage.jsx","import React from 'react';\r\nimport { Route, IndexRoute } from 'react-router';\r\nimport App from './pages/App/App';\r\n// import Vote from './universalPage/Vote';\r\nimport About from './pages/App/About';\r\n\r\n// require.ensure polyfill for node\r\nif (typeof require.ensure !== 'function') {\r\n    require.ensure = function requireModule(deps, callback) {\r\n        callback(require);\r\n    };\r\n}\r\n\r\nfunction onChange(prevState, nextState, replace, cb){\r\n    let lastRoute = nextState.routes[nextState.routes.length - 1];\r\n\r\n    if(lastRoute.component) {\r\n        let component = lastRoute.component;\r\n        let location = nextState.location;\r\n        let pageComponent = component.OriginalPage ? component.OriginalPage : component;\r\n\r\n        Object.assign(window.__APP_CONFIG__, {\r\n            pageId: location.query.pageId || (pageComponent.pageConfig && pageComponent.pageConfig.pageId)\r\n        });\r\n    }\r\n\r\n    cb();\r\n}\r\n\r\n\r\nexport default function(stores) {\r\n    return (\r\n        <Route path=\"/\" component={App} onChange={ onChange }>\r\n            <IndexRoute component={ require('./pages/App/Vote').default }/>\r\n            <Route path=\"vote\" component={ require('./pages/App/Vote').default }/>\r\n            <Route path=\"about\" component={About} />\r\n        </Route>\r\n    );\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/routes.js","import {\r\n    observable,\r\n    action,\r\n    runInAction,\r\n    extendObservable\r\n} from 'mobx';\r\n\r\nclass CommonStore {\r\n    constructor(state = {}) {\r\n        runInAction('CommonStore init', () => {\r\n            extendObservable(this, state)\r\n        });\r\n    }\r\n}\r\n\r\nexport default CommonStore;\n\n\n// WEBPACK FOOTER //\n// ./common/stores/CommonStore.js","import {\r\n    observable,\r\n    action,\r\n    runInAction,\r\n    extendObservable\r\n} from 'mobx';\r\n\r\nimport fetchList from '../fetchList';\r\n\r\nexport default class VoteStore {\r\n    @observable message = '';\r\n\r\n    constructor(state = {}){\r\n        runInAction('initialize VoteStore', () => {\r\n            extendObservable(this, state);\r\n        });\r\n    }\r\n\r\n    @action\r\n    loadData(opts, req){\r\n        console.log('loadData...');\r\n\r\n        return fetchList.getVote(opts, req).then(action('update state after fetching data', (resp) => {\r\n            this.message = resp.data.message;\r\n        }));\r\n    }\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/VoteStore.js","import CommonStore from './CommonStore';\r\nimport TimerStore from './TimerStore';\r\nimport TodoStore from './TodoStore';\r\nimport VoteStore from './VoteStore';\r\n\r\nfunction initStore(Store, state){\r\n    return Store.fromJS ? Store.fromJS(state) : new Store(state);\r\n}\r\n\r\nexport default function configureStore(state = {}){\r\n    return {\r\n        commonStore: initStore(CommonStore, state.commonStore),\r\n        timerStore: initStore(TimerStore, state.timerStore),\r\n        todoStore: initStore(TodoStore, state.todoStore),\r\n        VoteStore: initStore(VoteStore, state.VoteStore)\r\n    };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/stores/spaStores.js","import React, {\r\n    PropTypes\r\n} from 'react';\r\nimport { inject, observer } from 'mobx-react';\r\n// import { action } from 'mobx';\r\n\r\nimport Base from '../pages/Base';\r\n\r\nlet IS_FIRST_MOUNT_AFTER_LOAD = true;\r\nif (process.browser) {\r\n    var FIRST_PAGE_ID = window.__APP_CONFIG__.pageId;\r\n}\r\n\r\n\r\nexport default function connectDataFetchers(storeKeys = [], cache) {\r\n    return function (Page) {\r\n        if (process.browser) {\r\n            if (!Page.pageConfig) {\r\n                console.error(`Page Component static propery pageConfig.pageId required!`);\r\n            } else {\r\n                IS_FIRST_MOUNT_AFTER_LOAD = Page.pageConfig.pageId === FIRST_PAGE_ID;\r\n            }\r\n        }\r\n\r\n        class DataFetchersWrapper extends Base {\r\n            static propTypes = {\r\n                params: PropTypes.object,\r\n                location: PropTypes.shape({\r\n                    pathname: PropTypes.string.required,\r\n                    search: PropTypes.string,\r\n                    query: PropTypes.string.object\r\n                }).isRequired\r\n            };\r\n\r\n            static contextTypes = {\r\n                $appConfig: PropTypes.object,\r\n                mobxStores: PropTypes.object\r\n            };\r\n\r\n            static OriginalPage = Page;\r\n\r\n            static fetchData({\r\n                stores,\r\n                location,\r\n                params,\r\n                appConfig,\r\n                pageConfig\r\n            }, req) {\r\n                return Promise.all(\r\n                    storeKeys.map(storeKey => {\r\n                        let currentStore = stores[storeKey];\r\n\r\n                        return currentStore && currentStore.loadData && currentStore.loadData({\r\n                            location,\r\n                            params,\r\n                            appConfig,\r\n                            pageConfig\r\n                        })\r\n                    }, req));\r\n            }\r\n\r\n            shouldComponentUpdate(nextProps) {\r\n                return this.props !== nextProps;\r\n            }\r\n\r\n            componentDidUpdate(prevProps) {\r\n                const {\r\n                    location\r\n                } = this.props;\r\n                const {\r\n                    location: prevLocation\r\n                } = prevProps;\r\n\r\n                const isUrlChanged = (location.pathname !== prevLocation.pathname) ||\r\n                    (location.search.slice(1) !== prevLocation.search.slice(1));\r\n\r\n                if (isUrlChanged) {\r\n                    this._fetchDataOnClient();\r\n                }\r\n            }\r\n\r\n            componentDidMount() {\r\n                if (!cache) {\r\n                    if (!IS_FIRST_MOUNT_AFTER_LOAD) {\r\n                        this._fetchDataOnClient();\r\n                    }\r\n\r\n                    IS_FIRST_MOUNT_AFTER_LOAD = false;\r\n                } else {\r\n                    if (!IS_FIRST_MOUNT_AFTER_LOAD && !Page.DATA_LOADED) {\r\n                        this._fetchDataOnClient();\r\n                    }\r\n\r\n                    Page.DATA_LOADED = true;\r\n                    IS_FIRST_MOUNT_AFTER_LOAD = false;\r\n                }\r\n            }\r\n\r\n            _fetchDataOnClient() {\r\n                this.constructor.fetchData({\r\n                    stores: this.context.mobxStores,\r\n                    params: this.props.params,\r\n                    location: this.props.location,\r\n                    appConfig: this.context.$appConfig\r\n                });\r\n            }\r\n\r\n            render() {\r\n                return ( \r\n                    <Page {...this.props }/>\r\n                );\r\n            }\r\n        }\r\n\r\n        return DataFetchersWrapper;\r\n    };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./common/utils/connectDataFetchers.jsx","import { Router } from 'express';\r\n\r\nlet router = new Router();\r\n\r\nrouter.post('/ajax', function(req, res, next){\r\n    if(error) {\r\n        next();\r\n    } else {\r\n        res.send('test')\r\n    }\r\n});\r\n\r\nexport default router;\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/apis/index.js","import React from 'react';\r\nimport Page from '../../common/pages/timer/TimerPage.jsx';\r\nimport Store from '../../common/stores/TimerStore';\r\n\r\n\r\nmodule.exports = function (req, res, next) {\r\n    res.renderReactHTML({\r\n        component: <Page/>,\r\n        store: new Store(),\r\n        locals: {\r\n            appName: 'timer',\r\n            title: 'timer page'\r\n        },\r\n        pageConfig: {\r\n            user: 'test'\r\n        }\r\n    });\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/Timer.js","import React from 'react';\r\nimport Page from '../../common/pages/todo/TodoPage.jsx';\r\nimport Store from '../../common/stores/TodoStore';\r\nimport TodoModel from '../../common/models/TodoModel';\r\n\r\n\r\nmodule.exports = function (req, res, next) {\r\n    let store = new Store();\r\n\r\n    store.addTodo(new TodoModel({\r\n        id: 0,\r\n        title: \"Get Coffee\"\r\n    }));\r\n    store.addTodo(new TodoModel({\r\n        id: 1,\r\n        title: \"Write simpler code\"\r\n    }));\r\n\r\n    store.todos[0].setFinished(true);\r\n\r\n    res.renderReactHTML({\r\n        component: <Page/> ,\r\n        store,\r\n        locals: {\r\n            appName: 'todo',\r\n            title: 'todo page'\r\n        },\r\n        pageConfig: {\r\n            user: 'test'\r\n        }\r\n    });\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/Todo.js","\r\nexport default function allowCrossDomain(req, res, next) {\r\n    let allowedOrigins = [\r\n        'http://www.test.com'\r\n    ];\r\n    let origin = req.headers.origin;\r\n    if(allowedOrigins.indexOf(origin) > -1){\r\n        res.header('Access-Control-Allow-Origin', origin);\r\n    }\r\n    next();\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/allowCrossDomain.js","import React from 'react';\r\nimport {renderToString} from 'react-dom/server';\r\nimport {createMemoryHistory, match, RouterContext} from 'react-router';\r\nimport { Provider, useStaticRendering } from 'mobx-react';\r\nimport createRoutes from '../../common/routes';\r\nimport configureStore from '../../common/stores/spaStores.js';\r\nimport preRenderMiddleware from '../utils/preRender';\r\nimport ejs from 'ejs';\r\nimport config from '../config/config.json';\r\nimport { getDefaultJSVersion } from './renderReactMiddleware';\r\nimport App from '../../common/App.jsx';\r\nimport { jsObj as safeJSON } from 'secure-filters';\r\nimport fs from 'fs';\r\n\r\nconst defaultTemplate = fs.readFileSync(__dirname + '/../views/index.html', 'utf8');\r\n\r\nuseStaticRendering(true);\r\n\r\nexport default function renderMatch(req, res) {\r\n    const history = createMemoryHistory();\r\n    const stores = configureStore({\r\n        commonStore: {\r\n            user: {\r\n                name: 'test'\r\n            }\r\n        }\r\n    });\r\n    let appConfig = {\r\n        time: Date.now()\r\n    };\r\n    const routes = createRoutes(stores, appConfig);\r\n\r\n    match({routes, location: req.originalUrl}, async function (err, redirect, props){\r\n        if (err) {\r\n            res.status(500).json(err);\r\n        } else if (redirect) {\r\n            res.redirect(302, redirect.pathname + redirect.search);\r\n        } else if (props) {\r\n            let debug = req.query.debug && (req.query.debug === config.application.debugName);\r\n            let version = config.application.version;\r\n            let jsVersion = '';\r\n            // prefer config version, useful when using CDN config\r\n            if (process.env.NODE_ENV === 'production') {\r\n                jsVersion = version && version.js;\r\n            } else {\r\n                jsVersion = getDefaultJSVersion('app');\r\n            }\r\n            let componentHTML = '';\r\n            let errorMsg = '';\r\n\r\n            try {\r\n                await preRenderMiddleware(stores, props, appConfig, req);\r\n\r\n                componentHTML = renderToString(\r\n                    <Provider { ...stores }>\r\n                        <App appConfig={ appConfig }>\r\n                            <RouterContext {...props} />\r\n                        </App>\r\n                    </Provider>\r\n                );\r\n\r\n            } catch(ex){\r\n                errorMsg = ex.stack;\r\n                console.log(ex.stack)\r\n            }\r\n\r\n            let pageStr = ejs.render(defaultTemplate, Object.assign({\r\n                errorMsg,\r\n                html: componentHTML,\r\n                state: safeJSON(stores),\r\n                appName: 'app',\r\n                title: '',\r\n                test: process.env.NODE_ENV !== 'production',\r\n                debug: debug,\r\n                appConfig: safeJSON(appConfig),\r\n                version: {\r\n                    js: jsVersion,\r\n                    css: version && version.css\r\n                }\r\n            }, {}), {\r\n                compileDebug: false\r\n            });\r\n\r\n            res.status(200).send(pageStr);\r\n\r\n        } else {\r\n            res.redirect('/');\r\n        }\r\n    });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/spaRenderMatch.jsx","import { Router } from 'express';\r\nimport fs from 'fs';\r\n\r\nlet router = new Router();\r\n\r\nimport Timer from '../controllers/Timer';\r\nimport Todo from '../controllers/Todo';\r\n\r\n\r\n/**\r\n * 首页请求\r\n */\r\nrouter.get('/', Timer);\r\nrouter.get('/todo', Todo);\r\n\r\n\r\n/**\r\n * 静态资源\r\n */\r\nlet content = fs.readFileSync(__dirname + '/../../client/js/utils/sw.js', 'utf8');\r\n\r\nrouter.get('/sw.js', async function(req, res){\r\n    res.set('Content-Type', 'application/javascript');\r\n    res.send(content);\r\n});\r\n\r\nexport default router;\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/index.js","function preRender(stores, { components, location, params }, appConfig = {}, req) {\r\n    const promises = components.map((current) => {\r\n        if(!current) return null;\r\n\r\n        const component = current.WrappedComponent ? current.WrappedComponent : current;\r\n        const pageConfig = component.OriginalPage && component.OriginalPage.pageConfig;\r\n        \r\n        return component.fetchData ? component.fetchData({ stores, location, params, appConfig, pageConfig }, req) : null;\r\n    });\r\n\r\n    let lastComponent = components[components.length - 1].WrappedComponent ? components[components.length - 1].WrappedComponent : components[components.length - 1];\r\n    appConfig.pageId = lastComponent && lastComponent.OriginalPage && lastComponent.OriginalPage.pageConfig && lastComponent.OriginalPage.pageConfig.pageId;\r\n\r\n    return Promise.all(promises);\r\n}\r\n\r\nexport default preRender;\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/utils/preRender.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 39\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 40\n// module chunks = 0","module.exports = require(\"csurf\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"csurf\"\n// module id = 41\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 42\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 43\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 44\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 45\n// module chunks = 0"],"sourceRoot":""}